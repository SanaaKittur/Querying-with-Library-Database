CREATE DATABASE LIBRARY;
USE LIBRARY;

CREATE TABLE PUBLISHER
(NAME VARCHAR(20) PRIMARY KEY,
PHONE BIGINT,
ADDRESS VARCHAR(20));

CREATE TABLE BOOK
(BOOK_ID INTEGER PRIMARY KEY,
TITLE VARCHAR(20),
PUB_YEAR VARCHAR (20),
PUBLISHER_NAME VARCHAR(20),
FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER (NAME) );

CREATE TABLE BOOK_AUTHORS
(AUTHOR_NAME VARCHAR(20),
BOOK_ID INT,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID),
PRIMARY KEY (BOOK_ID, AUTHOR_NAME));

CREATE TABLE LIBRARY_BRANCH 
(BRANCH_ID INTEGER PRIMARY KEY, 
BRANCH_NAME VARCHAR(50),
ADDRESS VARCHAR(50));

CREATE TABLE BOOK_COPIES
(NO_OF_COPIES INTEGER,
BOOK_ID INT,
BRANCH_ID INT,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID),
FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH (BRANCH_ID) ,
PRIMARY KEY (BOOK_ID, BRANCH_ID));

CREATE TABLE BOOK_LENDING
(DATE_OUT DATE,
DUE_DATE DATE,
Card_No INT,
BOOK_ID INT,
BRANCH_ID INT,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID),
FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH (BRANCH_ID) ,
PRIMARY KEY (BOOK_ID, BRANCH_ID)); 

INSERT INTO PUBLISHER VALUES('Pearson',8764986528,'Delhi');
INSERT INTO PUBLISHER VALUES('Wiley',8769458976,'Jharkhand');
INSERT INTO PUBLISHER VALUES('McGraw Hill',7596784567,'Kolkata');
INSERT INTO PUBLISHER VALUES('Roopa',8796758945,'Bangalore');
INSERT INTO PUBLISHER VALUES('Roli',9807685647,'Bihar');
INSERT INTO PUBLISHER VALUES('Westland',8976049857,'London');
INSERT INTO PUBLISHER VALUES('Williamson',9867589765,'England');
INSERT INTO PUBLISHER VALUES('Simon',7845689128,'Newzealand');
INSERT INTO PUBLISHER VALUES('Penguin',8756942834,'Russia');
INSERT INTO PUBLISHER VALUES('Jaico',8945761235,'Tokyo');

INSERT INTO BOOK VALUES(10234,'DBMS',2001,'McGraw Hill');
INSERT INTO BOOK VALUES(10235,'Eng Phy',2000,'Pearson');
INSERT INTO BOOK VALUES(10236,'CTPY',2003,'Wiley');
INSERT INTO BOOK VALUES(10237,'Eng Maths',2002,'Roopa');
INSERT INTO BOOK VALUES(10238,'Why Me',2005,'Roli');
INSERT INTO BOOK VALUES(10239,'Darkness',2003,'Westland');
INSERT INTO BOOK VALUES(10240,'Mechanics',2008,'Williamson');
INSERT INTO BOOK VALUES(10241,'Organic Chem',2002,'Simon');
INSERT INTO BOOK VALUES(10242,'The wildlife',2001,'Penguin');
INSERT INTO BOOK VALUES(10243,'The Family',2006,'Jaico');

INSERT INTO BOOK_AUTHORS VALUES('Leo',10234);
INSERT INTO BOOK_AUTHORS VALUES('Robert',10235);
INSERT INTO BOOK_AUTHORS VALUES('John',10236);
INSERT INTO BOOK_AUTHORS VALUES('Oscar',10237);
INSERT INTO BOOK_AUTHORS VALUES('Jack',10238);
INSERT INTO BOOK_AUTHORS VALUES('Henry',10239);
INSERT INTO BOOK_AUTHORS VALUES('James',10240);
INSERT INTO BOOK_AUTHORS VALUES('Charlie',10241);
INSERT INTO BOOK_AUTHORS VALUES('Antony',10242);
INSERT INTO BOOK_AUTHORS VALUES('Justin',10243);

INSERT INTO LIBRARY_BRANCH VALUES(20,'Kudlugate','Bangalore');
INSERT INTO LIBRARY_BRANCH VALUES(21,'RT Nagar','Mangalore');
INSERT INTO LIBRARY_BRANCH VALUES(22,'Madihal','Dharwad');
INSERT INTO LIBRARY_BRANCH VALUES(23,'BTM','Davangere');
INSERT INTO LIBRARY_BRANCH VALUES(24,'RR Nagar','Udupi');
INSERT INTO LIBRARY_BRANCH VALUES(25,'HSR','Mysuru');
INSERT INTO LIBRARY_BRANCH VALUES(26,'Madiwala','Mandya');
INSERT INTO LIBRARY_BRANCH VALUES(27,'Indira Nagar','Tumkur');
INSERT INTO LIBRARY_BRANCH VALUES(28,'Chandapura','Hassan');
INSERT INTO LIBRARY_BRANCH VALUES(29,'Seoul','South Korea');

INSERT INTO BOOK_COPIES VALUES(100,10234,20);
INSERT INTO BOOK_COPIES VALUES(150,10235,21);
INSERT INTO BOOK_COPIES VALUES(200,10236,22);
INSERT INTO BOOK_COPIES VALUES(230,10237,23);
INSERT INTO BOOK_COPIES VALUES(240,10238,24);
INSERT INTO BOOK_COPIES VALUES(250,10239,25);
INSERT INTO BOOK_COPIES VALUES(300,10240,26);
INSERT INTO BOOK_COPIES VALUES(360,10241,27);
INSERT INTO BOOK_COPIES VALUES(280,10242,28);
INSERT INTO BOOK_COPIES VALUES(400,10243,29);

INSERT INTO BOOK_LENDING VALUES('2021-12-13','2022-01-13',101,10234,20);
INSERT INTO BOOK_LENDING VALUES('2021-12-04','2022-01-04',102,10235,21);
INSERT INTO BOOK_LENDING VALUES('2021-02-18','2021-02-18',103,10236,22);
INSERT INTO BOOK_LENDING VALUES('2021-09-01','2021-10-01',104,10237,23);
INSERT INTO BOOK_LENDING VALUES('2021-10-15','2021-11-15',105,10238,24);
INSERT INTO BOOK_LENDING VALUES('2021-03-13','2021-04-13',106,10239,25);
INSERT INTO BOOK_LENDING VALUES('2021-05-28','2021-06-28',107,10240,26);
INSERT INTO BOOK_LENDING VALUES('2021-07-27','2021-08-27',108,10241,27);
INSERT INTO BOOK_LENDING VALUES('2021-02-11','2021-03-11',109,10242,28);
INSERT INTO BOOK_LENDING VALUES('2021-12-13','2022-01-13',110,10243,29);
INSERT INTO BOOK_LENDING VALUES('2019-08-15','2019-09-15',109,10235,25);
INSERT INTO BOOK_LENDING VALUES('2018-01-24','2018-02-23',107,10241,22);
INSERT INTO BOOK_LENDING VALUES('2018-09-22','2018-10-22',107,10242,23);
INSERT INTO BOOK_LENDING VALUES('2017-02-21','2017-03-21',109,10240,20);
UPDATE BOOK_LENDING SET Card_No=107 WHERE BRANCH_ID=20;
UPDATE BOOK_LENDING SET BOOK_ID=10235 WHERE Card_No=110;
UPDATE BOOK_LENDING SET BOOK_ID=10235 WHERE BRANCH_ID=22;
UPDATE BOOK_LENDING SET DATE_OUT='2019-08-04' WHERE BOOK_ID=10234;
UPDATE BOOK_LENDING SET DATE_OUT='2017-11-09' WHERE BOOK_ID=10242;
-- 3)Retriev details 
SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME,
C.NO_OF_COPIES,L.BRANCH_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID=A.BOOK_ID
AND B.BOOK_ID=C.BOOK_ID
AND L.BRANCH_ID=C.BRANCH_ID; 
-- 4)Getting particulars of borrowers
SELECT Card_No FROM
BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-11-01' AND '2019-08-04'
GROUP BY Card_No
HAVING COUNT(*)>3;
-- 5)Deleting a Book
DELETE FROM BOOK WHERE BOOK_ID=10234;
DELETE FROM BOOK_LENDING WHERE BOOK_ID=10234;
DELETE FROM BOOK_COPIES WHERE BOOK_ID=10234;
DELETE FROM BOOK_AUTHORS WHERE BOOK_ID=10234;
-- 6)Partition of the book Table 
CREATE VIEW V_PUBLICATION AS SELECT
PUB_YEAR
FROM BOOK;
-- 7)Creating View
CREATE VIEW V_BOOKS AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM BOOK B, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID=C.BOOK_ID
AND C.BRANCH_ID=L.BRANCH_ID;

select * from book;
